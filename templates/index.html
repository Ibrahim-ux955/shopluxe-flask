{% extends 'base.html' %}

{% block content %}
<div class="container mt-5">

  <!-- Hero Carousel / Dynamic Products -->
  <div id="heroCarousel" class="carousel slide mb-5" data-bs-ride="carousel">
    <div class="carousel-indicators">
      {% set carousel_items = [
        ('üî• Most Popular', popular_products|first),
        ('‚ú® New Arrival', new_products|first),
        ('üíé Featured', featured_products|first),
        ('üí∞ On Sale', sale_products|first)
      ] %}
      {% for idx in range(carousel_items|length) %}
        {% if carousel_items[idx][1] %}
          <button type="button" data-bs-target="#heroCarousel" data-bs-slide-to="{{ idx }}" class="{% if idx==0 %}active{% endif %}"></button>
        {% endif %}
      {% endfor %}
    </div>

    <div class="carousel-inner">
      {% for item in carousel_items %}
        {% set label = item[0] %}
        {% set product = item[1] %}
        {% if product %}
          <div class="carousel-item {% if loop.first %}active{% endif %}">
            <img src="{{ url_for('static', filename='shoes/' + (product.image if product.get('image') else 'placeholder.jpg')) }}"
                 class="d-block w-100" alt="{{ product.name }}" style="height: 400px; object-fit: cover;">
            <div class="carousel-caption d-none d-md-block bg-dark bg-opacity-50 rounded p-2">
              <h5>{{ label }}</h5>
              <p>{{ product.name }}
                {% if product.on_sale and product.sale_price %}
                  - GH‚Çµ {{ product.sale_price }}
                {% endif %}
              </p>
            </div>
          </div>
        {% endif %}
      {% endfor %}
    </div>

    <button class="carousel-control-prev" type="button" data-bs-target="#heroCarousel" data-bs-slide="prev">
      <span class="carousel-control-prev-icon"></span>
      <span class="visually-hidden">Previous</span>
    </button>
    <button class="carousel-control-next" type="button" data-bs-target="#heroCarousel" data-bs-slide="next">
      <span class="carousel-control-next-icon"></span>
      <span class="visually-hidden">Next</span>
    </button>
  </div>

  <!-- ‚úÖ Search Results Header -->
  {% if query %}
    <div class="alert alert-light border text-center">
      <h5 class="mb-0">Search results for "<strong>{{ query }}</strong>": {{ products|length }} found</h5>
    </div>
  {% endif %}

  <!-- ‚úÖ No Products Found Message -->
  {% if not (popular_products or new_products or featured_products or sale_products or products) %}
    <div class="text-center mt-5">
      <h4>üõí No products found in this category.</h4>
      <p class="text-muted">Check back later for new arrivals!</p>
      <a href="{{ url_for('categories') }}" class="btn btn-outline-primary mt-3">
        ‚Üê Back to Categories
      </a>
    </div>
  {% endif %}

  <!-- Most Popular -->
  {% if popular_products %}
  <h4 class="mb-4 text-center text-dark">üî• Most Popular</h4>
  <div class="row g-3">
    {% for product in popular_products %}
      {% include 'partials/product_card.html' %}
    {% endfor %}
  </div>
  {% endif %}

  <!-- New Arrivals -->
  {% if new_products %}
  <h4 class="mb-4 mt-5 text-center text-dark">‚ú® New Arrivals</h4>
  <div class="row g-3">
    {% for product in new_products %}
      {% include 'partials/product_card.html' %}
    {% endfor %}
  </div>
  {% endif %}

  <!-- Featured Products -->
  {% if featured_products %}
  <h4 class="mb-4 mt-5 text-center text-dark">üíé Featured Products</h4>
  <div class="row g-3">
    {% for product in featured_products %}
      {% include 'partials/product_card.html' %}
    {% endfor %}
  </div>
  {% endif %}

  <!-- On Sale Products -->
  {% if sale_products %}
  <h4 class="mb-4 mt-5 text-center text-dark">üí∞ Products On Sale</h4>
  <div class="row g-3">
    {% for product in sale_products %}
      {% include 'partials/product_card.html' %}
    {% endfor %}
  </div>
  {% endif %}

</div>
{% endblock %}
